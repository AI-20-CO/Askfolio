'use client';

import { motion, useScroll, useTransform, useInView, Variants } from 'framer-motion';
import { useRef, useState } from 'react';
import { useTheme } from '@/context/ThemeContext';

// Symmetrical animation variants factory
const createVariants = (direction: 'left' | 'right' | 'top' | 'bottom' | 'center', distance = 100): Variants => {
  const offsets = {
    left: { x: -distance, y: 0 },
    right: { x: distance, y: 0 },
    top: { x: 0, y: -distance },
    bottom: { x: 0, y: distance },
    center: { x: 0, y: 0 },
  };
  const offset = offsets[direction];
  return {
    hidden: {
      opacity: 0,
      x: offset.x,
      y: offset.y,
      scale: direction === 'center' ? 0.85 : 0.95,
      filter: 'blur(10px)',
    },
    visible: {
      opacity: 1,
      x: 0,
      y: 0,
      scale: 1,
      filter: 'blur(0px)',
      transition: { duration: 0.5, ease: [0.25, 0.1, 0.25, 1] },
    },
  };
};

const containerVariants: Variants = {
  hidden: { opacity: 0 },
  visible: {
    opacity: 1,
    transition: { staggerChildren: 0.08, delayChildren: 0.05 },
  },
};

// Floating orb component (same as About)
function FloatingOrb({ delay, duration, size, left, top, color }: {
  delay: number;
  duration: number;
  size: number;
  left: string;
  top: string;
  color: string;
}) {
  return (
    <motion.div
      initial={{ opacity: 0, scale: 0 }}
      animate={{ 
        opacity: [0.3, 0.6, 0.3],
        scale: [1, 1.2, 1],
        y: [0, -30, 0],
        x: [0, 15, 0],
      }}
      transition={{
        duration,
        delay,
        repeat: Infinity,
        ease: 'easeInOut',
      }}
      style={{
        position: 'absolute',
        width: size,
        height: size,
        borderRadius: '50%',
        background: `radial-gradient(circle, ${color} 0%, transparent 70%)`,
        left,
        top,
        filter: 'blur(40px)',
        pointerEvents: 'none',
      }}
    />
  );
}

// Skill categories for the animated bars
const skillCategories = [
  {
    title: 'Languages',
    color: '#c4a35a',
    skills: [
      { name: 'Java', level: 95 },
      { name: 'TypeScript', level: 90 },
      { name: 'Python', level: 85 },
      { name: 'SQL', level: 85 },
    ],
  },
  {
    title: 'Frontend',
    color: '#61dafb',
    skills: [
      { name: 'React', level: 92 },
      { name: 'Next.js', level: 88 },
      { name: 'React Native', level: 85 },
      { name: 'Tailwind', level: 90 },
    ],
  },
  {
    title: 'Backend',
    color: '#a8c4a0',
    skills: [
      { name: 'Spring Boot', level: 90 },
      { name: 'FastAPI', level: 80 },
      { name: 'Node.js', level: 85 },
      { name: 'REST APIs', level: 92 },
    ],
  },
  {
    title: 'Java Enterprise',
    color: '#e57373',
    skills: [
      { name: 'OSGi', level: 85 },
      { name: 'Hibernate', level: 88 },
      { name: 'JPA', level: 90 },
      { name: 'JAX-RS', level: 85 },
    ],
  },
  {
    title: 'Cloud & DevOps',
    color: '#a0b4c4',
    skills: [
      { name: 'AWS', level: 85 },
      { name: 'Docker', level: 88 },
      { name: 'Kubernetes', level: 75 },
      { name: 'CI/CD', level: 85 },
    ],
  },
  {
    title: 'Databases',
    color: '#c4a0b4',
    skills: [
      { name: 'PostgreSQL', level: 90 },
      { name: 'MongoDB', level: 82 },
      { name: 'Redis', level: 78 },
      { name: 'MySQL', level: 88 },
    ],
  },
  {
    title: 'ML & Data',
    color: '#f7931e',
    skills: [
      { name: 'PyTorch', level: 75 },
      { name: 'Scikit-learn', level: 80 },
      { name: 'Pandas', level: 85 },
      { name: 'OpenAI API', level: 82 },
    ],
  },
];

// Segregated technologies by category
const segregatedTechnologies = [
  { category: 'Languages', techs: ['Java', 'TypeScript', 'JavaScript', 'Python', 'SQL', 'C++'], color: '#c4a35a' },
  { category: 'Frontend', techs: ['React', 'Next.js', 'React Native', 'Tailwind CSS', 'HTML5', 'CSS3'], color: '#61dafb' },
  { category: 'Backend', techs: ['Spring Boot', 'FastAPI', 'Node.js', 'Express', 'REST APIs', 'GraphQL'], color: '#a8c4a0' },
  { category: 'Java Enterprise', techs: ['OSGi', 'Hibernate', 'JPA', 'JAX-RS', 'Maven', 'Gradle'], color: '#e57373' },
  { category: 'Cloud & DevOps', techs: ['AWS', 'Docker', 'Kubernetes', 'Jenkins', 'CI/CD', 'Linux'], color: '#a0b4c4' },
  { category: 'Databases', techs: ['PostgreSQL', 'MongoDB', 'Redis', 'MySQL', 'DynamoDB'], color: '#c4a0b4' },
  { category: 'ML & Data', techs: ['PyTorch', 'Scikit-learn', 'Pandas', 'NumPy', 'OpenAI API'], color: '#f7931e' },
];

// Skill bar component - larger fonts
function SkillBar({ name, level, delay, color, isInView, theme, colors }: { 
  name: string; 
  level: number; 
  delay: number; 
  color: string;
  isInView: boolean;
  theme: 'dark' | 'light';
  colors: { text: string; textMuted: string };
}) {
  const [isHovered, setIsHovered] = useState(false);
  
  return (
    <motion.div
      initial={{ opacity: 0, x: -20 }}
      animate={isInView ? { opacity: 1, x: 0 } : {}}
      transition={{ duration: 0.5, delay }}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      style={{ marginBottom: '16px' }}
    >
      <div style={{
        display: 'flex',
        justifyContent: 'space-between',
        alignItems: 'center',
        marginBottom: '8px',
      }}>
        <span style={{
          fontSize: '15px',
          fontWeight: 400,
          color: isHovered ? color : colors.text,
          transition: 'color 0.3s ease',
        }}>
          {name}
        </span>
        <span style={{
          fontSize: '14px',
          color: colors.textMuted,
          fontWeight: 300,
        }}>
          {level}%
        </span>
      </div>
      <div style={{
        height: '4px',
        borderRadius: '2px',
        background: theme === 'dark' ? 'rgba(255, 255, 255, 0.08)' : 'rgba(0, 0, 0, 0.08)',
        overflow: 'hidden',
      }}>
        <motion.div
          initial={{ width: 0 }}
          animate={isInView ? { width: `${level}%` } : {}}
          transition={{ duration: 1, delay: delay + 0.2, ease: [0.4, 0, 0.2, 1] }}
          style={{
            height: '100%',
            borderRadius: '2px',
            background: `linear-gradient(90deg, ${color}, ${color}88)`,
            boxShadow: isHovered ? `0 0 12px ${color}60` : 'none',
            transition: 'box-shadow 0.3s ease',
          }}
        />
      </div>
    </motion.div>
  );
}

// Technology tag with hover effect - larger fonts
function TechTag({ tech, color, index, isInView, theme }: { tech: string; color: string; index: number; isInView: boolean; theme: 'dark' | 'light' }) {
  return (
    <motion.span
      initial={{ opacity: 0, y: 10 }}
      animate={isInView ? { opacity: 1, y: 0 } : {}}
      transition={{ duration: 0.4, delay: index * 0.03 }}
      whileHover={{ 
        scale: 1.08,
        background: `${color}25`,
        borderColor: color,
      }}
      style={{
        display: 'inline-block',
        padding: '8px 14px',
        borderRadius: '8px',
        background: theme === 'dark' ? 'rgba(255, 255, 255, 0.04)' : 'rgba(0, 0, 0, 0.04)',
        border: theme === 'dark' ? '1px solid rgba(255, 255, 255, 0.1)' : '1px solid rgba(0, 0, 0, 0.1)',
        fontSize: '13px',
        color: theme === 'dark' ? 'rgba(255, 255, 255, 0.8)' : 'rgba(0, 0, 0, 0.75)',
        cursor: 'default',
        transition: 'all 0.3s ease',
      }}
    >
      {tech}
    </motion.span>
  );
}

export default function Skills() {
  const ref = useRef(null);
  const isInView = useInView(ref, { amount: 0.35 });
  const [activeCategory, setActiveCategory] = useState(0);
  const { theme, colors } = useTheme();

  const { scrollYProgress } = useScroll({
    target: ref,
    offset: ['start end', 'end start'],
  });

  const opacity = useTransform(scrollYProgress, [0, 0.2, 0.8, 1], [0.5, 1, 1, 0.5]);

  return (
    <section
      id="skills"
      ref={ref}
      style={{
        minHeight: '100vh',
        padding: '80px 24px',
        display: 'flex',
        justifyContent: 'center',
        alignItems: 'center',
        position: 'relative',
        overflow: 'hidden',
        boxSizing: 'border-box',
        background: theme === 'dark'
          ? 'linear-gradient(180deg, #0a0a0a 0%, #0f0f0f 50%, #0a0a0a 100%)'
          : 'linear-gradient(180deg, #fafafa 0%, #f5f5f5 50%, #fafafa 100%)',
        transition: 'background 0.3s ease',
      }}
    >
      {/* Dynamic background orbs - same as About */}
      <FloatingOrb 
        delay={0} 
        duration={8} 
        size={300} 
        left="5%" 
        top="15%" 
        color={theme === 'dark' ? 'rgba(196, 163, 90, 0.12)' : 'rgba(13, 148, 136, 0.09)'} 
      />
      <FloatingOrb 
        delay={2} 
        duration={10} 
        size={200} 
        left="85%" 
        top="65%" 
        color={theme === 'dark' ? 'rgba(192, 192, 192, 0.08)' : 'rgba(100, 100, 100, 0.06)'} 
      />
      <FloatingOrb 
        delay={4} 
        duration={12} 
        size={250} 
        left="60%" 
        top="80%" 
        color={theme === 'dark' ? 'rgba(196, 163, 90, 0.06)' : 'rgba(13, 148, 136, 0.05)'} 
      />
      
      {/* Animated gradient overlay */}
      <motion.div
        animate={{
          background: theme === 'dark' ? [
            'radial-gradient(ellipse at 20% 30%, rgba(196, 163, 90, 0.05) 0%, transparent 50%)',
            'radial-gradient(ellipse at 80% 70%, rgba(196, 163, 90, 0.05) 0%, transparent 50%)',
            'radial-gradient(ellipse at 20% 30%, rgba(196, 163, 90, 0.05) 0%, transparent 50%)',
          ] : [
            'radial-gradient(ellipse at 20% 30%, rgba(13, 148, 136, 0.04) 0%, transparent 50%)',
            'radial-gradient(ellipse at 80% 70%, rgba(13, 148, 136, 0.04) 0%, transparent 50%)',
            'radial-gradient(ellipse at 20% 30%, rgba(13, 148, 136, 0.04) 0%, transparent 50%)',
          ],
        }}
        transition={{ duration: 10, repeat: Infinity, ease: 'linear' }}
        style={{
          position: 'absolute',
          inset: 0,
          pointerEvents: 'none',
        }}
      />
      
      <motion.div style={{ maxWidth: 1200, width: '100%', opacity, position: 'relative', zIndex: 1 }}>
        {/* Header - animates from left */}
        <motion.div
          variants={createVariants('left', 80)}
          initial="hidden"
          animate={isInView ? 'visible' : 'hidden'}
          style={{ marginBottom: '40px' }}
        >
          <motion.span
            initial={{ width: 0 }}
            animate={isInView ? { width: '40px' } : { width: 0 }}
            transition={{ duration: 0.8, delay: 0.2 }}
            style={{
              display: 'block',
              height: '2px',
              background: theme === 'dark' 
                ? 'linear-gradient(90deg, #c4a35a, transparent)'
                : 'linear-gradient(90deg, #0d9488, transparent)',
              marginBottom: '16px',
            }}
          />
          <span style={{
            fontSize: '12px',
            letterSpacing: '4px',
            textTransform: 'uppercase',
            color: theme === 'dark' ? 'rgba(196, 163, 90, 0.6)' : 'rgba(13, 148, 136, 0.7)',
            display: 'block',
            marginBottom: '12px',
          }}>
            Tech Stack
          </span>
          <h2 style={{
            fontSize: 'clamp(32px, 6vw, 56px)',
            fontWeight: 200,
            color: colors.text,
            margin: 0,
            lineHeight: 1.1,
          }}>
            Skills & expertise
          </h2>
        </motion.div>

        {/* Category tabs */}
        <motion.div
          variants={createVariants('right', 60)}
          initial="hidden"
          animate={isInView ? 'visible' : 'hidden'}
          className="hide-scrollbar"
          style={{
            display: 'flex',
            gap: '10px',
            marginBottom: '32px',
            flexWrap: 'nowrap',
            overflowX: 'auto',
            paddingBottom: '8px',
          }}
        >
          {skillCategories.map((category, index) => (
            <motion.button
              key={category.title}
              onClick={() => setActiveCategory(index)}
              whileHover={{ scale: 1.05 }}
              whileTap={{ scale: 0.98 }}
              style={{
                padding: '10px 18px',
                borderRadius: '8px',
                border: activeCategory === index 
                  ? `1px solid ${category.color}` 
                  : theme === 'dark' 
                    ? '1px solid rgba(255, 255, 255, 0.1)'
                    : '1px solid rgba(0, 0, 0, 0.1)',
                background: activeCategory === index 
                  ? `${category.color}15` 
                  : 'transparent',
                color: activeCategory === index 
                  ? category.color 
                  : colors.textMuted,
                fontSize: '14px',
                fontWeight: 500,
                cursor: 'pointer',
                transition: 'all 0.3s ease',
                letterSpacing: '0.5px',
                whiteSpace: 'nowrap',
                flexShrink: 0,
              }}
            >
              {category.title}
            </motion.button>
          ))}
        </motion.div>

        {/* Main content grid */}
        <motion.div 
          className="skills-grid" 
          variants={containerVariants}
          initial="hidden"
          animate={isInView ? 'visible' : 'hidden'}
          style={{
            display: 'grid',
            gridTemplateColumns: 'repeat(2, 1fr)',
            gap: '24px',
          }}
        >
          {/* Skill bars - Selected category */}
          <motion.div
            key={activeCategory}
            variants={createVariants('left', 50)}
            style={{
              padding: '28px',
              borderRadius: '20px',
              background: theme === 'dark'
                ? 'linear-gradient(145deg, rgba(30, 30, 35, 0.6) 0%, rgba(25, 25, 30, 0.4) 100%)'
                : 'linear-gradient(145deg, rgba(255, 255, 255, 0.9) 0%, rgba(245, 245, 245, 0.7) 100%)',
              border: theme === 'dark' 
                ? '1px solid rgba(255, 255, 255, 0.05)'
                : '1px solid rgba(0, 0, 0, 0.08)',
              boxShadow: theme === 'light' ? '0 2px 8px rgba(0, 0, 0, 0.04)' : 'none',
            }}
          >
            <h3 style={{
              fontSize: '18px',
              fontWeight: 500,
              color: skillCategories[activeCategory].color,
              marginBottom: '24px',
            }}>
              {skillCategories[activeCategory].title}
            </h3>
            <div>
              {skillCategories[activeCategory].skills.map((skill, index) => (
                <SkillBar
                  key={skill.name}
                  name={skill.name}
                  level={skill.level}
                  delay={index * 0.08}
                  color={skillCategories[activeCategory].color}
                  isInView={isInView}
                  theme={theme}
                  colors={{ text: colors.text, textMuted: colors.textMuted }}
                />
              ))}
            </div>
          </motion.div>

          {/* All Technologies - Scrollable with fade */}
          <motion.div
            variants={createVariants('right', 50)}
            style={{
              padding: '28px',
              borderRadius: '20px',
              background: theme === 'dark'
                ? 'linear-gradient(145deg, rgba(30, 30, 35, 0.4) 0%, rgba(25, 25, 30, 0.2) 100%)'
                : 'linear-gradient(145deg, rgba(255, 255, 255, 0.7) 0%, rgba(245, 245, 245, 0.5) 100%)',
              border: theme === 'dark' 
                ? '1px solid rgba(255, 255, 255, 0.03)'
                : '1px solid rgba(0, 0, 0, 0.05)',
              display: 'flex',
              flexDirection: 'column',
              maxHeight: '450px',
              boxShadow: theme === 'light' ? '0 2px 8px rgba(0, 0, 0, 0.03)' : 'none',
            }}
          >
            <h3 style={{
              fontSize: '18px',
              fontWeight: 500,
              color: colors.text,
              marginBottom: '20px',
              flexShrink: 0,
            }}>
              All Technologies
            </h3>
            <div
              className="tech-scroll hide-scrollbar"
              style={{
                flex: 1,
                overflowY: 'auto',
                display: 'flex',
                flexDirection: 'column',
                gap: '20px',
                paddingRight: '8px',
                maskImage: 'linear-gradient(to bottom, black 0%, black 80%, transparent 100%)',
                WebkitMaskImage: 'linear-gradient(to bottom, black 0%, black 80%, transparent 100%)',
              }}
            >
              {segregatedTechnologies.map((group, groupIndex) => (
                <motion.div
                  key={group.category}
                  initial={{ opacity: 0, y: 15 }}
                  animate={isInView ? { opacity: 1, y: 0 } : { opacity: 0, y: 15 }}
                  transition={{ duration: 0.5, delay: groupIndex * 0.1 }}
                >
                  <div style={{
                    fontSize: '11px',
                    color: group.color,
                    letterSpacing: '2px',
                    textTransform: 'uppercase',
                    marginBottom: '10px',
                    fontWeight: 600,
                  }}>
                    {group.category}
                  </div>
                  <div style={{ display: 'flex', flexWrap: 'wrap', gap: '8px' }}>
                    {group.techs.map((tech, index) => (
                      <TechTag 
                        key={tech} 
                        tech={tech} 
                        color={group.color} 
                        index={index} 
                        isInView={isInView}
                        theme={theme}
                      />
                    ))}
                  </div>
                </motion.div>
              ))}
            </div>
          </motion.div>
        </motion.div>
      </motion.div>

      <style jsx global>{`
        .hide-scrollbar {
          -ms-overflow-style: none;
          scrollbar-width: none;
        }
        .hide-scrollbar::-webkit-scrollbar {
          display: none;
        }
        @media (max-width: 768px) {
          .skills-grid {
            grid-template-columns: 1fr !important;
          }
        }
      `}</style>
    </section>
  );
}
